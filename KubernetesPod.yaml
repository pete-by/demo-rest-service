
metadata:
  labels:
    app: rest-demo-service
spec:
  securityContext:
    fsGroup: 1000
  volumes:
    - name: maven-repo-pv
      persistentVolumeClaim:
        claimName: maven-repo-pvc
  initContainers:
    - name: volume-mount-hack
      image: busybox
      command: [ "sh", "-c", "chown -R 1000:1000 /home/jenkins/.m2" ]
      volumeMounts:
        - name: maven-repo-pv
          mountPath: /home/jenkins/.m2
  containers:
    - name: jnlp
      env:
        - name: CONTAINER_ENV_VAR
          value: jnlp
    - name: build-container
      image: docker.io/peteby/build-container:1.10.0
      securityContext:
        fsGroup: 1000
        runAsUser: 1000
        runAsGroup: 1000
      tty: true
      command: ["cat"]
      env:
        - name: CONTAINER_ENV_VAR
          value: build-container
      volumeMounts:
        - mountPath: "/home/jenkins/.m2"
          name: maven-repo-pv
          readOnly: false
  imagePullSecrets:
    - name: regcred